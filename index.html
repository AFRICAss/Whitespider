<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
		<title>Unblocker!</title>
		<style type="text/css">
* {
	margin: 0px;
	padding: 0px;
}

body {
	position: absolute;
	display: block;
	width: 100%;
	height: 100%;
	font-size: 14px;
	font-family: monospace;
	font-weight: 500;
	overflow-x: hidden;
}

#main-screen, #noscript-screen {
	position: absolute;
	width: 100%;
	height: 100%;
	left: 0px;
	top: 0px;
	right: 0px;
	bottom: 0px;
}

#noscript-screen {
	padding: 10px;
	box-sizing: border-box;
}

#title {
	position: relative;
	display: block;
	width: fit-content;
	height: fit-content;
	margin: auto;
	padding: 20px;
	white-space: pre;
}

#input-bar {
	position: relative;
	display: flex;
	width: fit-content;
	height: fit-content;
	margin: auto;
	padding: 10px;
}

#input {
	position: relative;
	display: block;
	width: 200px;
	height: auto;
	padding: 10px;
	outline: none;
	margin-right: 10px;
	font-size: 14px;
	font-weight: 500;
	font-family: monospace;
	border-style: solid;
	border-width: 1px;
	border-color: #808080;
}

#input:focus {
	border-color: #000000;
}

#load {
	position: relative;
	display: block;
	width: fit-content;
	height: auto;
	padding: 10px;
	cursor: pointer;
	font-size: 14px;
	font-weight: 600;
	color: #ffffff;
	background-color: #606060;
	border-style: solid;
	border-width: 1px;
	border-top-color: #f0f0f0;
	border-left-color: #f0f0f0;
	border-bottom-color: #101010;
	border-right-color: #101010;
}

#load:active {
	border-top-color: #101010;
	border-left-color: #101010;
	border-bottom-color: #f0f0f0;
	border-right-color: #f0f0f0;
}

#footer {
	position: absolute;
	display: block;
	width: 100%;
	height: 30px;
	bottom: 0px;
	line-height: 30px;
	font-size: 12px;
	font-family: monospace;
	font-weight: 500;
	text-align: center;
	color: #808080;
	background-color: #f0f0f0;
}
		</style>
	</head>
	<body>
		<div id="main-screen">
			<div id="title">
 _    _         _      _               _
| |  | |       | |    | |             | |
| |  | | _ __  | |__  | |  ___    ___ | | __ ___  _ __
| |  | || '_ \ | '_ \ | | / _ \  / __|| |/ // _ \| '__|
| |__| || | | || |_) || || (_) || (__ |   &#60;|  __/| |
 \____/ |_| |_||_.__/ |_| \___/  \___||_|\_\\___||_|
			</div>
			<div id="input-bar">
				<input id="input" type="url" value="https://" placeholder="Content URL" />
				<div id="load">Load</div>
			</div>
		</div>
		<div id="footer">Created by Ruochen Jia -- <a href="https://github.com/ruochenjia/unblocker/">GitHub Project</a></div>
		<noscript>
			<div id="noscript-screen">Please enable JavaScript and refresh this page to continue.</div>
		</noscript>
		<script type="text/javascript" src="uv/uv.bundle.js"></script>
		<script type="text/javascript" src="uv/uv.config.js"></script>
		<script type="text/javascript">
"use strict";

// <![CDATA[
(() => {

function checkUrl(url) {
	try {
		return new URL(url).href;
	} catch(err) {
		return null;
	}
}

function getQueryString(name, fallback = null, url = window.location.href) {
	name = name.replace(/[\[\]]/g, '\\$&');
	let regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
	let results = regex.exec(url);
	if (results == null)
		return fallback;
	if (results[2] == null)
		return "";
	return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

let urlInput = document.getElementById("input");
document.getElementById("load").onclick = () => run();
urlInput.onkeydown = (e) => {
	if (e.keyCode == 13)
		run();
};

function encodeUrl(url) {
	let eurl = __uv$config.encodeUrl(url);
	let base = new URL(window.location.href);
	base.pathname = "/";
	base = base.href.slice(0, -1);
	return base +  __uv$config.prefix + eurl;
}

async function run() {
	let url = checkUrl(urlInput.value);
	if (url == null) {
		alert("Please input a valid URL which must start with http:// or https://", "Error");
		return;
	}

	await window.navigator.serviceWorker.register("./sw.js", {
    	scope:  __uv$config.prefix
	});

	window.location = new URL(encodeUrl(url));
}

})();
// ]]>
		</script>
	</body>
</html>